<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jmu.fyl.logistics.dao.StationDao">

    <resultMap id="stationMap" type="Station">
        <id property="stationId" column="station_id"/>
        <result property="stationCode" column="station_code"/>
        <result property="stationName" column="station_name"/>
        <result property="address" column="address"/>
        <result property="phone" column="phone"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <insert id="insert" parameterType="Station" useGeneratedKeys="true" keyProperty="stationId">
        INSERT INTO stations (station_code, station_name, address, phone, status)
        VALUES (#{stationCode}, #{stationName}, #{address}, #{phone},  #{status})
    </insert>

    <update id="update" parameterType="Station">
        UPDATE stations
        <set>
            <if test="stationCode != null and stationCode != ''">station_code = #{stationCode},</if>
            <if test="stationName != null and stationName != ''">station_name = #{stationName},</if>
            <if test="address != null and address != ''">address = #{address},</if>
            <if test="phone != null and phone != ''">phone = #{phone},</if>
            <if test="status != null">status = #{status},</if>
            update_time = NOW()
        </set>
        WHERE station_id = #{stationId}
    </update>

    <delete id="delete" parameterType="int">
        DELETE FROM stations WHERE station_id = #{id}
    </delete>

    <select id="findById" parameterType="int" resultMap="stationMap">
        SELECT * FROM stations WHERE station_id = #{id}
    </select>

    <select id="findAll" resultMap="stationMap">
        SELECT * FROM stations ORDER BY create_time DESC
    </select>

    <select id="findByCode" parameterType="string" resultMap="stationMap">
        SELECT * FROM stations WHERE station_code = #{stationCode}
    </select>

    <select id="findByStatus" parameterType="int" resultMap="stationMap">
        SELECT * FROM stations WHERE status = #{status} ORDER BY station_code
    </select>

    <select id="findByNameLike" parameterType="string" resultMap="stationMap">
        SELECT * FROM stations
        WHERE station_name LIKE CONCAT('%', #{name}, '%')
        ORDER BY station_code
    </select>

    <select id="checkCodeExists" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM stations WHERE station_code = #{stationCode}
    </select>

    <select id="findByCondition" parameterType="map" resultMap="stationMap">
        SELECT * FROM stations
        <where>
            <if test="stationCode != null and stationCode != ''">AND station_code = #{stationCode}</if>
            <if test="stationName != null and stationName != ''">AND station_name LIKE CONCAT('%', #{stationName}, '%')</if>
            <if test="status != null">AND status = #{status}</if>
        </where>
        ORDER BY create_time DESC
        <if test="start != null and limit != null">
            LIMIT #{limit} OFFSET #{start}
        </if>
    </select>

    <select id="countByCondition" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM stations
        <where>
            <if test="stationCode != null and stationCode != ''">AND station_code = #{stationCode}</if>
            <if test="stationName != null and stationName != ''">AND station_name LIKE CONCAT('%', #{stationName}, '%')</if>
            <if test="status != null">AND status = #{status}</if>
        </where>
    </select>

</mapper>